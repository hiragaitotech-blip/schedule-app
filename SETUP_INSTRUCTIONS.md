# Supabase セットアップ手順（完全版）

## 🚀 簡単セットアップ

**1つのSQLファイルで全て完了します！**

### 実行手順

1. Supabaseダッシュボードにログイン
2. SQL Editorを開く
3. `supabase_complete_setup.sql` の内容をすべてコピー
4. SQL Editorに貼り付けて実行

**これだけです！**

---

## 📋 このSQLで実行される内容

### ✅ テーブル作成
- `tenants` - テナントテーブル
- `profiles` - ユーザープロフィール（`is_active`カラム含む）
- `cases` - 案件テーブル
- `slots` - スロットテーブル
- `candidate_availabilities` - 候補者回答テーブル

### ✅ スキーマ更新
- `profiles`テーブルに`is_active`カラムを追加（既存の場合）
- 既存レコードを有効化

### ✅ RLS設定
- 全テーブルでRLSを有効化
- テナント分離ポリシーを設定
- データベース層でのセキュリティを確保

---

## ⚠️ 注意事項

### 既存のテーブルがある場合

- `CREATE TABLE IF NOT EXISTS` を使用しているため、既存のテーブルはスキップされます
- `ALTER TABLE ... ADD COLUMN IF NOT EXISTS` を使用しているため、既存のカラムはスキップされます
- `DROP POLICY IF EXISTS` を使用しているため、既存のポリシーは削除されて再作成されます

### 既存データへの影響

- ✅ **既存のデータは削除されません**
- ✅ **既存のデータは変更されません**（`is_active`の更新のみ）
- ✅ **安全に実行できます**

---

## 🔍 実行後の確認

### 1. テーブルが作成されているか確認
- Supabaseダッシュボード → Table Editor
- 以下のテーブルが表示されているか確認：
  - `tenants`
  - `profiles`
  - `cases`
  - `slots`
  - `candidate_availabilities`

### 2. RLSが有効化されているか確認
- 各テーブルを開く
- 「RLS」列が「Enabled」になっているか確認

### 3. ポリシーが作成されているか確認
- 各テーブルを開く
- 「Policies」タブでポリシーが表示されているか確認

---

## ❓ よくある質問

### Q: 既存のテーブルがある場合、データは消えますか？

**A: いいえ、消えません。** `IF NOT EXISTS`を使用しているため、既存のテーブルはスキップされます。

### Q: エラーが出た場合は？

**A: エラーメッセージを確認してください。**
- 既に存在するテーブル/カラム/ポリシーに関するエラーは無視して問題ありません
- 重大なエラーの場合は、エラーメッセージを確認して対応してください

### Q: ダミーデータは必要ですか？

**A: 任意です。** テスト用のダミーデータが必要な場合は、SQLファイルの最後の部分のコメントアウトを外してください。

---

## ✅ 完了

SQLを実行したら、セットアップは完了です！

次は、アプリケーションを起動して動作確認してください。

