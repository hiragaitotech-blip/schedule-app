# スーパー管理者機能のセットアップ

## 🎯 概要

スーパー管理者機能により、SaaS運営者（あなた）がすべての企業（テナント）を一元管理できます。

## ⚙️ セットアップ手順

### Step 1: 環境変数の設定

`.env.local`に以下を追加してください：

```env
# スーパー管理者のメールアドレス
SUPER_ADMIN_EMAIL=your-email@example.com
```

**重要**: このメールアドレスでログインしているユーザーのみがスーパー管理者機能にアクセスできます。

### Step 2: スーパー管理者アカウントの作成

1. **Supabase Authでユーザーを作成**
   - Supabaseダッシュボード → Authentication → Users
   - 「Add user」をクリック
   - メールアドレス: `.env.local`で設定したメールアドレス
   - パスワード: 任意のパスワード

2. **プロフィールを作成（オプション）**
   - テナントに所属させる必要はありません
   - スーパー管理者はテナントに所属しなくても機能します

### Step 3: 動作確認

1. スーパー管理者のメールアドレスでログイン
2. Navbarに「管理画面」リンクが表示されることを確認
3. `/admin/tenants`にアクセスしてテナント管理画面が表示されることを確認

---

## 🔐 セキュリティ

### スーパー管理者の権限

- ✅ 全テナントの一覧を閲覧可能
- ✅ 新規テナントを作成可能
- ✅ 各テナントの統計情報（ユーザー数、案件数）を閲覧可能
- ⚠️ 各テナントの詳細データには直接アクセスできません（RLSにより保護）

### 注意事項

1. **環境変数の管理**
   - `.env.local`はGitにコミットしないでください
   - 本番環境では、Vercel等の環境変数設定で`SUPER_ADMIN_EMAIL`を設定してください

2. **スーパー管理者のメールアドレス**
   - 変更する場合は、`.env.local`を更新して再起動してください
   - 複数のメールアドレスを指定する場合は、コードを修正する必要があります

---

## 📋 機能一覧

### `/admin/tenants` - テナント管理画面

#### 表示される情報
- 全テナント一覧
- 各テナントのユーザー数
- 各テナントの案件数
- 作成日

#### 操作
- ✅ 新規テナント作成
  - テナント名（企業名）
  - 管理者メールアドレス
  - 管理者パスワード（オプション）
- ✅ 一時パスワードの表示・コピー

---

## 🚀 使い方

### 新規企業のオンボーディング

1. **スーパー管理者でログイン**
2. **`/admin/tenants`にアクセス**
3. **「+ 新規テナント作成」をクリック**
4. **情報を入力**
   - テナント名: 企業名（例: 株式会社○○人材紹介）
   - 管理者メールアドレス: その企業の管理者のメールアドレス
   - 管理者パスワード: 任意（未入力の場合は自動生成）
5. **「テナントを作成」をクリック**
6. **生成された一時パスワードをコピー**
7. **企業の管理者に以下を共有**
   - ログインURL: `https://your-domain.com/login`
   - メールアドレス: 入力したメールアドレス
   - パスワード: 生成された一時パスワード

---

## 🔧 トラブルシューティング

### 「管理画面」リンクが表示されない

1. `.env.local`に`SUPER_ADMIN_EMAIL`が設定されているか確認
2. ログインしているメールアドレスが`SUPER_ADMIN_EMAIL`と一致しているか確認
3. 開発サーバーを再起動（環境変数の変更を反映）

### `/admin/tenants`にアクセスできない

1. スーパー管理者でログインしているか確認
2. ブラウザのコンソールでエラーを確認
3. サーバーログでエラーを確認

---

## 📝 今後の拡張案

- テナント詳細ページ（各テナントのユーザー一覧、案件一覧）
- テナントの有効化/無効化
- テナント削除機能
- 統計グラフ（テナント数、ユーザー数の推移など）
- 検索・フィルタ機能

---

## ✅ 完了

これで、スーパー管理者機能のセットアップは完了です！

企業のオンボーディングが簡単になりました。


